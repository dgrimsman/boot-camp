---
title: "first_glance"
output:
  html_document:
    toc: true
    toc_float: true
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Scientific Questions

What kind of questions and results are we looking for?

- Q: How can we improve routing from a simple grid?
  
  - A: [Generic] Use triangulated network. Compare distances between start/end points.
  
  - A: [Application] Compare with extra whale risk conserved & less shipping distance traversed for this example. Results:
  
    - Show boxplot of grid vs triangulated routing and efficiencies gained on y axis for whales & shipping
    
    - Show plot of how parameter for triangulation (like angle) on x-axis changes, how efficincies are gained in whale conservation / shipping distance on y-axis 
    
    - Showing the Shiny app before/after this new routing mechanism. Embedded as a HTML slideshow.
  
- Q: How can we improve routing from a simple grid?


## Technical Questions

Let's try to use <https://github.com/dgrimsman/boot-camp/issues>.

## Data

British Columbia (BC)

- land: `bc_spp_gcs.shp`
- whales: `v72zw_epsg3857.grd`

### raster of whale hot spots

```{r whales, message=F}
library(raster) # install.packages('rgdal')

whales = raster('data/v72zw_epsg3857.grd')
plot(whales)
```

### ports to route between

```{r ports, message=FALSE}
library(readr)

ports = read_csv('data/ports_bc.csv')
```


### interactive map

```{r}
library(leaflet)

leaflet() %>%
  addProviderTiles("Stamen.TonerLite", options = providerTileOptions(noWrap = TRUE)) %>% 
  addRasterImage(
    whales, opacity = 0.8, project = F, group='Raster',
    colors = colorNumeric(
      palette = 'Reds', domain = c(cellStats(whales, 'min'), cellStats(whales, 'max')), 
      na.color = "#00000000", alpha = TRUE)) %>%
  addCircleMarkers(
    ~lon, ~lat, color='blue', data=ports, layerId=~name, group='Ports',
    popup = ~sprintf('<b>%s</b><br>%0.2f, %0.2f', name, lon, lat)) %>%
  addLayersControl(
    overlayGroups = c('Raster', 'Ports'),
    options = layersControlOptions(collapsed=T))
```

## Testing New Packages

### RBGL

```{r install, eval=FALSE}
source("https://bioconductor.org/biocLite.R")
biocLite("RBGL")
```

```{r}
library(RBGL)

# astar search
con <- file(system.file("XML/dijkex.gxl",package="RBGL"), open="r")
coex <- fromGXL(con)
close(con)
astarSearch(coex)
```

### RTriangle

- [Computational Geometry in Python](http://blancosilva.github.io/post/2014/10/28/Computational-Geometry-in-Python.html#convex-hulls)

```{r}
library(RTriangle)

## Create an object with a concavity
p <- pslg(P=rbind(c(0, 0), c(0, 1), c(0.5, 0.5), c(1, 1), c(1, 0)),
          S=rbind(c(1, 2), c(2, 3), c(3, 4), c(4, 5), c(5, 1)))

## Plot it
plot(p)

## Triangulate it
tp <- triangulate(p)
plot(tp)

## Load a data set containing a hole
A <- read.pslg(file.path(system.file(package = "RTriangle"), "extdata", "A.poly"))
plot(A)
## Triangulate the PSLG
tA <- triangulate(A)
plot(tA)
## Triangulate the PSLG with triangles in which no angle
## is smaller than 20 degrees
tA <- triangulate(A, q=20)
plot(tA)
## Triangulate the PSLG with triangles in which no triangle has 
## area greater than 0.001
tA <- triangulate(A, a=0.001)
plot(tA)

source('custom.R')
ply = read.pslg('data/superior.poly')
plot(ply)
t_ply <- triangulate(ply)
plot(t_ply)
t_ply <- triangulate(ply, q=20, D=T) # 'pq20D'
plot(t_ply)
```



## R Tips Background

- [HTML Documents - rmarkdown](http://rmarkdown.rstudio.com/html_document_format.html#code_folding)

